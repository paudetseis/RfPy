<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorials &mdash; Home 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=a58bc63e"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Scripts" href="scripts.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Home
              <img src="_static/RfPy_logo_small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="links.html">GitHub Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html#references">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="rfpy.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfpy.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfpy.html#basic-usage">Basic Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html#modules">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Scripts &amp; Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-stdb-database">0. Creating the <code class="docutils literal notranslate"><span class="pre">StDb</span></code> Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-and-process-receiver-functions">1. Download and process receiver functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#re-calculate-with-different-options">2. Re-calculate with different options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-receiver-functions-by-back-azimuth-or-slowness">3. Plot receiver functions by back-azimuth or slowness</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#back-azimuth-panel">Back-azimuth panel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slowness-panel">Slowness panel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing">4. Post-processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-moho-depth-and-vp-vs-from-h-k-stacking">4a. Moho depth and Vp/Vs from <code class="docutils literal notranslate"><span class="pre">H-k</span></code> stacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#b-harmonic-decomposition">4b. Harmonic decomposition</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Home</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorials</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorials.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Link to this heading"></a></h1>
<p>In this tutorial we will process and post-process receiver function data for station
MMPY. This will include calculating receiver functions using all default arguments,
re-calculating the receiver functions for different processing arguments, plotting
them, and post-processing them using the H-k stacking technique and applying
the harmonic decomposition method.</p>
<section id="creating-the-stdb-database">
<h2>0. Creating the <code class="docutils literal notranslate"><span class="pre">StDb</span></code> Database<a class="headerlink" href="#creating-the-stdb-database" title="Link to this heading"></a></h2>
<p>All the scripts provided require a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> database containing station
information and metadata. Let’s first create this database for station
<code class="docutils literal notranslate"><span class="pre">MMPY</span></code> and send the prompt to a logfile</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ query_fdsn_stdb -N NY -S MMPY MMPY &gt; logfile
</pre></div>
</div>
<p>To check the station info for MMPY, use the program <code class="docutils literal notranslate"><span class="pre">ls_stdb</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls_stdb MMPY.pkl
Listing Station Pickle: MMPY.pkl
NY.MMPY
--------------------------------------------------------------------------
1) NY.MMPY
     Station: NY MMPY
      Alternate Networks: None
      Channel: HH ;  Location: --
      Lon, Lat, Elev:  62.61892, -131.26247,   0.000
      StartTime: 2013-07-01 00:00:00
      EndTime:   2020-10-26 15:28:46
      Status:    partial
      Polarity: 1
      Azimuth Correction: 0.000000
</pre></div>
</div>
</section>
<section id="download-and-process-receiver-functions">
<h2>1. Download and process receiver functions<a class="headerlink" href="#download-and-process-receiver-functions" title="Link to this heading"></a></h2>
<p>You can see above that the station MMPY has been in operation between July 2013
and October 2020 (Note: the date at which the tutorial was written). In theory,
we could run the main script to perform the automatic processing of the seismic
data (<code class="docutils literal notranslate"><span class="pre">rfpy_calc</span></code>) using for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_calc MMPY.pkl
</pre></div>
</div>
<p>However, in this example we would be looking at over seven years of data,
which is much more than we need for this tutorial. Note also that we didn’t specify
a station key, since there is only one station in the data base. By default,
<code class="docutils literal notranslate"><span class="pre">rfpy_calc</span></code> would process data for all teleseismic P-waves from earthquakes
with magnitudes between 6 and 9 and with epicentral distances between 30 and 90
degrees that occurred between July 2013 and October 2020. The default component
alignment is <code class="docutils literal notranslate"><span class="pre">ZRT</span></code> and the default deconvolution method is the <code class="docutils literal notranslate"><span class="pre">wiener</span></code> filter.</p>
<p>Let’s run an example where we want to limit the time range, include earthquakes
with magnitude down to 5.5, change the component alignment and the deconvolution method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_calc --minmag=5.5 --start=2017-05-01 --end=2017-10-31 --align=LQT --method=multitaper
</pre></div>
</div>
<p>An example log printed on the terminal will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|===============================================|</span>
<span class="o">|===============================================|</span>
<span class="o">|</span>                       <span class="n">MMPY</span>                    <span class="o">|</span>
<span class="o">|===============================================|</span>
<span class="o">|===============================================|</span>
<span class="o">|</span>  <span class="n">Station</span><span class="p">:</span> <span class="n">NY</span><span class="o">.</span><span class="n">MMPY</span>                             <span class="o">|</span>
<span class="o">|</span>      <span class="n">Channel</span><span class="p">:</span> <span class="n">HH</span><span class="p">;</span> <span class="n">Locations</span><span class="p">:</span> <span class="o">--</span>               <span class="o">|</span>
<span class="o">|</span>      <span class="n">Lon</span><span class="p">:</span> <span class="o">-</span><span class="mf">131.26</span><span class="p">;</span> <span class="n">Lat</span><span class="p">:</span>  <span class="mf">62.62</span>                <span class="o">|</span>
<span class="o">|</span>      <span class="n">Start</span> <span class="n">time</span><span class="p">:</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>          <span class="o">|</span>
<span class="o">|</span>      <span class="n">End</span> <span class="n">time</span><span class="p">:</span>   <span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">15</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">46</span>          <span class="o">|</span>
<span class="o">|-----------------------------------------------|</span>
<span class="o">|</span> <span class="n">Searching</span> <span class="n">Possible</span> <span class="n">events</span><span class="p">:</span>                    <span class="o">|</span>
<span class="o">|</span>   <span class="n">Start</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                  <span class="o">|</span>
<span class="o">|</span>   <span class="n">End</span><span class="p">:</span>   <span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">31</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                  <span class="o">|</span>
<span class="o">|</span>   <span class="n">Mag</span><span class="p">:</span>   <span class="mf">5.5</span> <span class="o">-</span> <span class="mf">9.0</span>                            <span class="o">|</span>
<span class="o">|</span> <span class="o">...</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">Found</span>   <span class="mi">179</span> <span class="n">possible</span> <span class="n">events</span>                  <span class="o">|</span>
<span class="o">|===============================================|</span>

<span class="o">**************************************************</span>
<span class="o">*</span> <span class="c1">#1 (5/179):  20170503_044713 NY.MMPY</span>
<span class="o">*</span> <span class="n">Requesting</span> <span class="n">Waveforms</span><span class="p">:</span>
<span class="o">*</span>    <span class="n">Startime</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">33</span>
<span class="o">*</span>    <span class="n">Endtime</span><span class="p">:</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">33</span>
<span class="o">*</span>     <span class="n">MMPY</span><span class="o">.</span><span class="n">HH</span> <span class="o">-</span> <span class="n">ZNE</span><span class="p">:</span>
<span class="o">*</span>          <span class="n">HH</span><span class="p">[</span><span class="n">ZNE</span><span class="p">]</span><span class="o">.--</span> <span class="o">-</span> <span class="n">Checking</span> <span class="n">Network</span>
<span class="o">*</span>              <span class="o">-</span> <span class="n">ZNE</span> <span class="n">Data</span> <span class="n">Downloaded</span>
<span class="o">*</span> <span class="n">Start</span> <span class="n">times</span> <span class="n">are</span> <span class="ow">not</span> <span class="nb">all</span> <span class="n">close</span> <span class="n">to</span> <span class="n">true</span> <span class="n">start</span><span class="p">:</span>
<span class="o">*</span>   <span class="n">HHE</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.230000</span><span class="n">Z</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">34.220000</span><span class="n">Z</span>
<span class="o">*</span>   <span class="n">HHN</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.230000</span><span class="n">Z</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">34.220000</span><span class="n">Z</span>
<span class="o">*</span>   <span class="n">HHZ</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.230000</span><span class="n">Z</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">34.220000</span><span class="n">Z</span>
<span class="o">*</span>   <span class="kc">True</span> <span class="n">start</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.229590</span><span class="n">Z</span>
<span class="o">*</span> <span class="o">-&gt;</span> <span class="n">Shifting</span> <span class="n">traces</span> <span class="n">to</span> <span class="n">true</span> <span class="n">start</span>
<span class="o">*</span> <span class="n">Waveforms</span> <span class="n">Retrieved</span><span class="o">...</span>
<span class="o">**************************************************</span>

<span class="o">...</span>
</pre></div>
</div>
<p>And so on until all data have been downloaded and processed. At that point you should
have a new folder named <code class="docutils literal notranslate"><span class="pre">P_DATA/NY.MMPY</span></code> containing all event folders, each of
them containing the meta data, station data, raw data, and receiver function data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls -R * | head

MMPY.csv
MMPY.pkl
P_DATA

./P_DATA:
NY.MMPY

./P_DATA/NY.MMPY:
20170503_044713
20170509_015414
</pre></div>
</div>
<p>Once this step is done, you can still re-calculate the receiver functions using
different processing options (see below). However, some parameters cannot be changed
easily without re-downloading the raw data (e.g., length of processing window,
sampling rate). If you want to change those parameters, run the previous command with
<code class="docutils literal notranslate"><span class="pre">-O</span></code> to override anything that exists on disk.</p>
<p>Note that you can get more data by either specifying a new phase to analyze (e.g.,
<code class="docutils literal notranslate"><span class="pre">--phase=PP</span></code>), going to lower magnitudes (e.g., <code class="docutils literal notranslate"><span class="pre">--minmag=5.</span> <span class="pre">--maxmag=5.5</span></code>), by
running the same line of command with those additional arguments.</p>
</section>
<section id="re-calculate-with-different-options">
<h2>2. Re-calculate with different options<a class="headerlink" href="#re-calculate-with-different-options" title="Link to this heading"></a></h2>
<p>If later on you decide you want to try a different deconvolution method, component
alignment or maybe try some pre-filtering options, you can always simply use the
<code class="docutils literal notranslate"><span class="pre">rfpy_recalc</span></code> script to do so.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Re-calculating the receiver functions for different options will override any
existing receiver function data. Be mindful of this when using this script.</p>
</div>
<p>This can be done by typing in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_recalc --align=ZRT --method=wiener MMPY.pkl
</pre></div>
</div>
</section>
<section id="plot-receiver-functions-by-back-azimuth-or-slowness">
<h2>3. Plot receiver functions by back-azimuth or slowness<a class="headerlink" href="#plot-receiver-functions-by-back-azimuth-or-slowness" title="Link to this heading"></a></h2>
<p>Now that we have our data set of receiver functions, we can plot it! There are two
types of plots: the Back-azimuth panels and the Slowness panels. In the first case
the receiver functions are sorted by back-azimuth and all slowness information is
lost (i.e., averaged out). In the same case it is the opposite and the receiver
fuuntions are sorted by slowness and all back-azimuth information is lost. When
plotting, you can decide whether to include all data, or set some quality control
thresholds based on 1) SNR of vertical component, 2) CC value of predicted and
observed radial components, and 3) outliers. If you don’t specify any thresholding,
by default the script <code class="docutils literal notranslate"><span class="pre">rfpy_plot</span></code> will use all data in the plots. You also want
to set corner frequencies for filterig, otherwise it will be difficult to see
anything. Typically you would choose a bandwidth that encompasses the dominant
frequencies of teleseismic P waves (i.e., 0.05 to 1 Hz). Let’s examine
the two types of plots with examples:</p>
<section id="back-azimuth-panel">
<h3>Back-azimuth panel<a class="headerlink" href="#back-azimuth-panel" title="Link to this heading"></a></h3>
<p>Below we make a plot of all P receiver functions, filtered between 0.05 and 0.5 Hz,
using 36 back-azimuth bins. We plot the RFs from -2. to +30 seconds following the
zero-lag (i.e., P-wave arrival) time, stack all traces to produce an averaged RF,
and normalize all traces to that of the stacks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_plot --no-outlier --bp=0.05,0.5 --nbaz=36 --normalize --trange=-2.,30. MMPY.pkl
</pre></div>
</div>
<figure class="align-center">
<img alt="_images/Figure_1.png" src="_images/Figure_1.png" />
</figure>
</section>
<section id="slowness-panel">
<h3>Slowness panel<a class="headerlink" href="#slowness-panel" title="Link to this heading"></a></h3>
<p>Now let’s make a plot of all P receiver functions, this time sorted by slowness using
20 bins. Instead</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_plot --no-outlier --bp=0.05,0.5 --nslow=20 --normalize --trange=-2.,30. MMPY.pkl
</pre></div>
</div>
<figure class="align-center">
<img alt="_images/Figure_2.png" src="_images/Figure_2.png" />
</figure>
</section>
</section>
<section id="post-processing">
<h2>4. Post-processing<a class="headerlink" href="#post-processing" title="Link to this heading"></a></h2>
<section id="a-moho-depth-and-vp-vs-from-h-k-stacking">
<h3>4a. Moho depth and Vp/Vs from <code class="docutils literal notranslate"><span class="pre">H-k</span></code> stacking<a class="headerlink" href="#a-moho-depth-and-vp-vs-from-h-k-stacking" title="Link to this heading"></a></h3>
<p>With these receiver functions, we can easily estimate Moho depth and crustal Vp/Vs
using the simple H-k stacking method. There are several options to choose from. Let’s
examine the default options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_hk MMPY.pkl
</pre></div>
</div>
<p>By default the script will use all available receiver functions (no thresholding), bin
them using 36 back-azimuth and 40 slowness bins, and stack them using H and k intervals
of 0.5 and 0.02, respectively, with bounds of [20., 50] and [1.56, 2.1], respectively
for H and k search. The weights for the Ps, Pps and Pss phases is [0.5, 2., -1] and
the final H-k stack will be the weighted sum of all 3 phases. The default crustal Vp
value to use in calculating the phase arrival time is 6.0 km/s. Finally, after
computing the stacks, nothing is done and the code stops. To produce a plot and save
the results to disk requires adding processing arguments.</p>
<p>As an example, let’s remove outliers, using 20 slowness bins (instead of 40 to speed
things up), change the weights to [1., 1., 0], change the Vp to 5.5 km/s, save the
H-k object and make a plot with some title:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_hk --no-outlier --nslow=20 --weights=1.,1.,0. --vp=5.5 --save --plot --title=&#39;First attempt&#39; MMPY.pkl

#########################################
#        __                 _     _     #
#  _ __ / _|_ __  _   _    | |__ | | __ #
# | &#39;__| |_| &#39;_ \| | | |   | &#39;_ \| |/ / #
# | |  |  _| |_) | |_| |   | | | |   &lt;  #
# |_|  |_| | .__/ \__, |___|_| |_|_|\_\ #
#          |_|    |___/_____|           #
#                                       #
#########################################

Path to HK_DATA/NY.MMPY doesn`t exist - creating it


|===============================================|
|===============================================|
|                       MMPY                    |
|===============================================|
|===============================================|
|  Station: NY.MMPY                             |
|      Channel: HH; Locations: --               |
|      Lon: -131.26; Lat:  62.62                |
|      Start time: 2013-07-01 00:00:00          |
|      End time:   2020-10-26 15:28:46          |
|-----------------------------------------------|

Number of radial RF data: 90


Number of radial RF bins: 16

Computing: [#####..........] 24/61
</pre></div>
</div>
<p>Once computing is done (when it reaches 61/61), the script will produce the following
figure:</p>
<figure class="align-center">
<img alt="_images/Figure_3.png" src="_images/Figure_3.png" />
</figure>
<p>Alternatively, we can compute the stacks using the product of all phase stacks, which
gets rid of the subjective choice of weights. Let’s re-do the prevous example with a
number of changes: 1) use a copy of the RFs to use for the reverberations (Pps and
Pss), 2) bandpass filter those at lower high-frequency corner, and 3) select the
‘product’ method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_hk --no-outlier --nslow=20 --vp=5.5 --copy --bp-copy=0.05,0.35 --type=product --save --plot --title=&#39;Second attempt&#39; MMPY.pkl
</pre></div>
</div>
<p>The new figure is slightly different (there is no negative amplitude) but produces
much cleaner H and k estimates. Note that the labeled weights above each panel
correspond to the default values but are not used in the final stack.</p>
<figure class="align-center">
<img alt="_images/Figure_4.png" src="_images/Figure_4.png" />
</figure>
<p>Finally, could also perform H-k stacking using a known orientation (strike and dip
angles) of a dipping interface using additional arguments.</p>
</section>
<section id="b-harmonic-decomposition">
<h3>4b. Harmonic decomposition<a class="headerlink" href="#b-harmonic-decomposition" title="Link to this heading"></a></h3>
<p>Receiver functions are often characterized by significant amplitude variations as a function
of back-azimuth of the incoming teleseismic wave. The variations are observed on both radial
and transverse components, with a 90-degree shift (in back-azimuth) between the two
components. The harmonic decomposition method exploits these variations by decomposing the
amplitude (at each time interval) into a set of harmonic components that describe the
periodicity in receiver function amplitudes. See <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2014JB011821">Audet (2015)</a> for details on the
methodology.</p>
<p>The default arguments will perform the decomposition over all receiver functin data at a
fixed azimuth of 0 degrees (i.e., North), such that the second and third components
represent 1-theta variations oriented in the N-S and E-W directions, calculated over the
first 10 seconds of the receiver function data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_harmonics MMPY.pkl
</pre></div>
</div>
<p>This command simply runs the decomposition algorithm but does not return anything, unless
you specify the <code class="docutils literal notranslate"><span class="pre">--save</span></code> and/or the <code class="docutils literal notranslate"><span class="pre">--plot</span></code> command. Instead of the default 0-degree
azimuth, you can set the azimuth at which you wish to perform the decomposition by setting
the <code class="docutils literal notranslate"><span class="pre">--azim=</span></code> argument. It is also possible to estimate the azimuth at which one of the
harmonic components will be minimized (typically the second or third term), in order to
reveal the dominant orientation of the receiver function amplitudes. This is accomplished
using the <code class="docutils literal notranslate"><span class="pre">--find-azim</span></code> argument. Finally, you can also set the range of lag times over
which to calculate the decomposition (<code class="docutils literal notranslate"><span class="pre">--trange=</span></code>; default is from 0 to 10 seconds) and
perform the decomposition for a selected date range (<code class="docutils literal notranslate"><span class="pre">--start=</span></code> and <code class="docutils literal notranslate"><span class="pre">--end=</span></code>). Other QC
control arguments are similar to previous scripts.</p>
<p>Let’s perform the decomposition by estimating the dominant azimuth using a time range of 2
to 10 seconds (to avoid the large zero-lag pulse):</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Warning!! This command is particularly slow, especially for large data sets.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_harmonics --no-outlier --find-azim --trange=2.,10. MMPY.pkl

################################################################################
#        __                 _                                      _           #
#  _ __ / _|_ __  _   _    | |__   __ _ _ __ _ __ ___   ___  _ __ (_) ___ ___  #
# | &#39;__| |_| &#39;_ \| | | |   | &#39;_ \ / _` | &#39;__| &#39;_ ` _ \ / _ \| &#39;_ \| |/ __/ __| #
# | |  |  _| |_) | |_| |   | | | | (_| | |  | | | | | | (_) | | | | | (__\__ \ #
# |_|  |_| | .__/ \__, |___|_| |_|\__,_|_|  |_| |_| |_|\___/|_| |_|_|\___|___/ #
#          |_|    |___/_____|                                                  #
#                                                                              #
################################################################################



|===============================================|
|===============================================|
|                       MMPY                    |
|===============================================|
|===============================================|
|  Station: NY.MMPY                             |
|      Channel: HH; Locations: --               |
|      Lon: -131.26; Lat:  62.62                |
|      Start time: 2013-07-01 00:00:00          |
|      End time:   2020-10-26 15:28:46          |
|-----------------------------------------------|

Decomposing receiver functions into baz harmonics
Optimal azimuth for trange between 2.0 and 10.0 seconds is: 178.0
</pre></div>
</div>
<p>Now that we have the estimated azimuth, we can re-calculate the decomposition using
<code class="docutils literal notranslate"><span class="pre">--azim=</span></code> and plot them over the first 20 seconds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_harmonics --no-outlier --azim=178. --trange=2.,10., --plot --ymax=20. --title=&quot;Decomposition at azimuth 178 degrees&quot; MMPY.pkl
</pre></div>
</div>
<p>This command will produce the following figure:</p>
<figure class="align-center">
<img alt="_images/Figure_5.png" src="_images/Figure_5.png" />
</figure>
<p>The first component (<code class="docutils literal notranslate"><span class="pre">A</span></code>) shows the amplitudes that do not vary with back-azimuth (i.e.,
the ‘constant’ term), with the main Ps and Pps Moho-related pulses at 3. and 15. seconds.
The second component (<code class="docutils literal notranslate"><span class="pre">B1</span></code>) has been minimized between 2. and 10. seconds and does not
show any significant signal. The third component (<code class="docutils literal notranslate"><span class="pre">B2</span></code>) shows the amplitudes at the
optimal azimuth of 178 degrees, with a pair of positive-negative pulses at around 7 and 8
seconds. Finally, the fourth component (<code class="docutils literal notranslate"><span class="pre">C1</span></code>) shows some high-amplitude signals between
2.5 and 6 seconds, which correspond to hexagonal anisotropy with a horizontal axis of
symmetry.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="scripts.html" class="btn btn-neutral float-left" title="Scripts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Pascal Audet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>